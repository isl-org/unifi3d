# @package _global_

# ----- This configs is for testing. It trained the SDF-DiT model on a single object ----

# to execute this experiment with single GPU run:
# accelerate launch scripts/acc_train.py experiment=overfit_diffuse_sdf_dit

defaults:
  - override /data: sdf
  - override /model: diffusion
  - override /net_encode: vqvae
  - override /net_denoise: dit
  - override /diffusion_sampler: ddpm
  - override /trainer: default
  - override /logger: aim     # default is null.


# all parameters below will be merged with parameters from default configurations set above
# this allows you to overwrite only specified parameters

tags: ["train", "sdf", "diffusion"]
seed: 12345
experiment_name: "diff_sdf_dit_overfit"

net_encode:
  ckpt_path: ???
  
net_denoise:
  patch_embed: 
    _target_: unifi3d.models.modules.patch_embed.PatchEmbed3D
    embed_dim: 768
    patch_size: 4
  in_channels: 3
  hidden_size: 768

diffusion_sampler:
  clip_sample: True

model:
  encoder_decoder: ${net_encode}
  diff_model: ${net_denoise}
  sampling_scheduler: ${diffusion_sampler}

data:
  batch_size: 1
  dataset:
    _target_: unifi3d.data.data_iterators.TestIterator
    path: "knot"
    mode: "train"
  test_dataset:
    _target_: unifi3d.data.data_iterators.TestIterator
    path: "knot"
    mode: "test"
  val_dataset:
    _target_: unifi3d.data.data_iterators.TestIterator
    path: "knot"
    mode: "val"

trainer:
  max_epochs: 900
  log_every_n_iter: 1000
  check_val_every_n_epoch: 100
  batch_post_process: null

paths:
  log_dir: ${paths.root_dir}/logs/${experiment_name}

test: false